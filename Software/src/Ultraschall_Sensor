// https://elektro.turanis.de/html/prj121/index.html : Grundlage der Sensorimplementierung

const int SENSOR_MAX_RANGE = 60; // in cm
double duration;
unsigned int distance;
double entfernung1;
double entfernung2;
double v;
double t;
double t1;
double t2;

/*
Diese Funktion gibt die Entfernung eines Gegenstandes zurueck.
*/
double Entfernungsmessung (int PIN_TRIGGER, int PIN_ECHO)
{
  digitalWrite(PIN_TRIGGER, LOW);
  delayMicroseconds(2);

  digitalWrite(PIN_TRIGGER, HIGH);
  delayMicroseconds(10);

  duration = pulseIn(PIN_ECHO, HIGH);
  distance = duration/58; //Schallgeschwindigkeit des Puls 29µs für 1cm in Luft; Weg hin und zurück, bedeutet Wert auf 58µs verdoppeln
  //time = millis();
  t = millis();
    if (distance > SENSOR_MAX_RANGE|| distance <= 0){
        distance = 0;
    }
return distance;
}

/*
Diese Funktion misst die Geschwindigkeit des vorbei fliegenden Gegenstandes.
*/
void Geschwindigkeitsmessung (int PIN_TRIGGER, int PIN_ECHO)
{
entfernung1 = Entfernungsmessung(PIN_TRIGGER, PIN_ECHO);
t1 = t;
//delay(20);
entfernung2 = Entfernungsmessung(PIN_TRIGGER, PIN_ECHO);
t2 = t;
Serial.println(t1);
Serial.println(t2);
Serial.println(entfernung1);
Serial.println(entfernung2);
v = (entfernung2 - entfernung1) * (t2 - t1)/1000;
Serial.print("Geschwindigkeit: ");
Serial.println(v);
}
