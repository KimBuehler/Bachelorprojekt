// https://starthardware.org/arduino-a4988-nema17/ : Informationen fuer die Steuerung des Schrittmotors
// https://docs.arduino.cc/built-in-examples/basics/AnalogReadSerial : Dokumentation zum Auslesen eines Potentiometers
double IstWinkel = 175;
int steps;
int Wunschwinkel;
const double steigung = 2.84; // Durch Versuch und anschlie√üender linearer Regression ermittelt
const double wertBei0Grad = 255.75; // Beliebig gewaehlter Wert, bei Montage, aendert sich bei Umbau

/*
Diese Funktion stellt den Abwurfwinkel ein und ueberprueft, welcher Winkel tatsaechlich eingestellt wurde. 
*/
void Winkeleinstellung (int stepsProUmdrehung, int direction, int step){
  Serial.println ("Bitte gebe den gewuenschten Winkel ein: ");
  delay(5000);
  Wunschwinkel = 0; //(int) Serial.read();
  if (Wunschwinkel<IstWinkel){
    digitalWrite(direction, HIGH); //im Uhrzeigersinn
    steps = round(((IstWinkel-Wunschwinkel) * stepsProUmdrehung)/360); //Umrechnung wie viele Steps gemacht werden
  }
  else if (Wunschwinkel > IstWinkel){
    digitalWrite(direction, LOW); // gegen den Uhrzeigersinn
    steps = round(((Wunschwinkel - IstWinkel)* stepsProUmdrehung) /360); //Umrechnung wie viele Steps gemacht werden
  } else {
    steps = 0;
  }
    for(int stepCounter = 0; stepCounter < steps; stepCounter++) {
      digitalWrite(step,HIGH);
      delayMicroseconds(5000);
      digitalWrite(step,LOW);
      delayMicroseconds(5000);
      
    }
delay(1000);
Serial.println (analogRead(A1));
IstWinkel = (analogRead(A1) - wertBei0Grad)/steigung ;
Serial.print ("Es wurde folgender Winkel in Grad eingestellt: ");
Serial.println (IstWinkel);
Serial.print ("Es wurde folgender Poti-Wert ausgelesen: ");
Serial.println (wertBei0Grad);
Serial.println (analogRead(A1));
}
